---
import client from '@tina/__generated__/client'
import { TinaMarkdown } from 'tinacms/dist/rich-text'
import BaseLayout from '../layouts/BaseLayout.astro'

const intentions = await client.queries.intentionsConnection()
const firstIntentions = intentions?.data?.intentionsConnection?.edges?.[0]?.node
const title = firstIntentions?.title || ''
const description = firstIntentions?.description || ''
const days = {
  day_0: 'Poniedziałek',
  day_1: 'Wtorek',
  day_2: 'Środa',
  day_3: 'Czwartek',
  day_4: 'Piątek',
  day_5: 'Sobota',
  day_6: 'Niedziela'
} as const
---

<BaseLayout>
  <header class='mx-auto mb-6 w-full max-w-3xl sm:mb-8'>
    <h2 class='font-serif text-2xl font-medium leading-tight sm:text-4xl'>
      {title}
    </h2>

    <p class='mt-1 text-sm leading-tight'>{description}</p>
  </header>
  <div class='flex flex-col divide-y divide-foreground'>
    {
      Object.entries(days).map(([key, value]) => {
        const dayIntentions =
          firstIntentions?.[key as keyof typeof firstIntentions] || []
        return (
          <div class='pt-4'>
            <h3 class='pb-4 font-serif text-xl font-medium leading-tight sm:text-2xl'>
              {value}
            </h3>
            <div class='flex flex-col divide-y divide-accent'>
              {Array.isArray(dayIntentions) &&
                dayIntentions.map((intention: any) => (
                  <div class='inline-flex w-full transition-colors duration-150 hover:bg-accent'>
                    <span class='block p-4 text-xl font-bold'>
                      {intention.hour}
                    </span>
                    <div class='prose flex w-full grow items-center align-middle prose-p:text-lg'>
                      <TinaMarkdown content={intention.intention} />
                    </div>
                  </div>
                ))}
            </div>
          </div>
        )
      })
    }
  </div>
</BaseLayout>
